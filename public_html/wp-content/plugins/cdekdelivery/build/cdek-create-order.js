(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var d in r)e.o(r,d)&&!e.o(t,d)&&Object.defineProperty(t,d,{enumerable:!0,get:r[d]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.i18n,r=window.jQuery;var d=e.n(r);const a=window.wp.apiFetch;var c=e.n(a);d()(document).ready((()=>{let e=[];function r(){const e=d()("#cdek-status-block").data("status-available");void 0===e||e||(d()("#order_data").find('input[name="order_date"]').attr("disabled",!0),d()("#order_data").find('input[name="order_date_hour"]').attr("disabled",!0),d()("#order_data").find('input[name="order_date_minute"]').attr("disabled",!0),d()("#order_data").find('select[name="customer_user"]').attr("disabled",!0),d()("#order_data").find('a[class="edit_address"]').hide())}r(),d()("#selected_product").change((function(){let e=d()("#selected_product").val();d()("#product_"+e).css("display","flex")})),d()("#save_package").click((function(){d()("#package_list").show();let r={};if(r.length=d()("input[name=package_length]").val(),r.width=d()("input[name=package_width]").val(),r.height=d()("input[name=package_height]").val(),r.items=[],d()(".product_list").each((function(e,t){"none"!==d()(t).css("display")&&r.items.push({id:d()(t).find("input[name=product_id]").val(),name:d()(t).find("input[type=text]").val(),quantity:d()(t).find("input[type=number]").val()})})),function(e){return""===e.length?(alert((0,t.__)("Packing length not specified","cdekdelivery")),!1):""===e.width?(alert((0,t.__)("Packing width not specified","cdekdelivery")),!1):""===e.height?(alert((0,t.__)("Packing height not specified","cdekdelivery")),!1):0!==e.items.length||(alert((0,t.__)("Products not added to packaging","cdekdelivery")),!1)}(r)){e.push(r);let a="";a=`${(0,t.__)("Package","cdekdelivery")} №${e.length} (${r.length}х${r.width}х${r.height}):`,r.items.forEach((function(e){a+=`${e.name} х${e.quantity}, `})),d()("#package_list").append(`<p>${a.slice(0,-2)}</p>`),d()(".product_list").each((function(e,t){if("none"!==d()(t).css("display")){let e=d()(t).find("input[type=number]").attr("max")-d()(t).find("input[type=number]").val();0!==e?d()(t).find("input[type=number]").attr("max",e):d()("#selected_product option").each((function(e,r){d()(r).text()===d()(t).find("input[type=text]").val()&&d()(r).remove()}))}})),d()("#selected_product").val(-1),d()(".product_list").each((function(e,t){d()(t).find("input[type=number]").val(1),d()(t).css("display","none"),d()("input[name=package_length]").val(""),d()("input[name=package_width]").val(""),d()("input[name=package_height]").val("")})),1===d()("#selected_product option").length&&(d()("#setting_block").hide(),d()("#save_package_btn_block").hide(),d()("#send_package_btn_block").show())}}));let a=null;d()("#cdek-order-waybill, #cdek-order-barcode").click((function(e){e.preventDefault(),e.stopPropagation();const t=d()("#cdek-loader");null!==a&&URL.revokeObjectURL(a),t.show(),c()({method:"GET",url:e.target.href}).then((e=>{if(!e.success)return void alert(e.message);const t=window.atob(e.data),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);a=window.URL.createObjectURL(new Blob([r],{type:"application/pdf"}));const d=window.document.createElement("a");d.target="_blank",d.href=a,window.document.body.appendChild(d),d.click(),d.remove(),window.document.addEventListener("beforeunload",(()=>URL.revokeObjectURL(a)))})).catch((e=>console.error(e))).finally((()=>t.hide()))})),d()("#send_package").click((function(t){const r=d()("#cdek-loader");r.show(),c()({method:"POST",url:t.target.dataset.action,data:{packages:e}}).then((e=>{e.state?(e.door&&(d()("#cdek-courier-result-block").hide(),d()("#cdek-order-courier").show()),d()("#cdek-create-order-form").hide(),d()("#cdek-order-number").html(`№ <b>${e.code}</b>`),d()("#cdek-order-number-input").val(e.code),d()("#cdek-info-order").show()):d()("#cdek-create-order-error").text(e.message).show()})).catch((e=>console.error(e))).finally((()=>r.hide()))})),d()("#create-order-btn").click((function(e){d()("#cdek-create-order-error").hide(),d()("#cdek-loader").show(),c()({method:"POST",url:e.target.dataset.action,data:{packages:[{length:d()("input[name=package_length]").val(),width:d()("input[name=package_width]").val(),height:d()("input[name=package_height]").val()}]}}).then((e=>{e.state?(e.door&&(d()("#cdek-courier-result-block").hide(),d()("#cdek-order-courier").show()),d()("#cdek-status-block").data("status-available",e.available),r(),d()("#cdek-order-status-block").html(e.statuses),d()("#cdek-create-order-form").hide(),d()("#cdek-order-number").html(`№ <b>${e.code}</b>`),d()("#cdek-order-number-input").val(e.code),d()("#cdek-info-order").show()):d()("#cdek-create-order-error").text(e.message).show()})).catch((e=>console.log(e))).finally((()=>d()("#cdek-loader").hide()))})),d()("#delete-order-btn").click((function(e){e.preventDefault(),d()(e.target).addClass("clicked"),d()("#cdek-create-order-error").hide(),d()("#cdek-courier-error").hide(),d()("#cdek-loader").show(),c()({method:"POST",url:e.target.href}).then((t=>{t.state?(alert(t.message),d()(e.target).removeClass("clicked"),d()("#cdek-create-order-form").show(),d()("#cdek-info-order").hide()):(d()("#cdek-delete-order-error").text(t.message).show(),d()("#delete-order-btn").hide())})).catch((e=>console.error(e))).finally((()=>d()("#cdek-loader").hide()))})),d()("#cdek-courier-send-call").click((function(e){d()("#cdek-courier-error").hide(),d()("#cdek-loader").show(),c()({method:"POST",url:e.target.dataset.action,data:{order_id:d()("input[name=package_order_id]").val(),date:d()("#cdek-courier-date").val(),starttime:d()("#cdek-courier-startime").val(),endtime:d()("#cdek-courier-endtime").val(),name:d()("#cdek-courier-name").val(),phone:d()("#cdek-courier-phone").val(),address:d()("#cdek-courier-address").val(),desc:d()("#cdek-courier-package-desc").val(),comment:d()("#cdek-courier-comment").val(),weight:d()("#cdek-courier-weight").val(),length:d()("#cdek-courier-length").val(),width:d()("#cdek-courier-width").val(),height:d()("#cdek-courier-height").val(),need_call:d()("#cdek-courier-call").prop("checked")}}).then((e=>{e?(d()("#call-courier-form").hide(),d()("#cdek-order-courier").hide(),d()("#cdek-courier-info").text(e.message).show(),d()("#cdek-courier-result-block").show()):d()("#cdek-courier-error").html(e.message).show()})).catch((e=>console.error(e))).finally((()=>d()("#cdek-loader").hide()))})),d()("#cdek-order-courier").click((function(){d()("#call-courier-form").toggle()})),d()("#cdek-courier-delete").click((function(e){d()("#cdek-loader").show(),c()({method:"POST",url:e.target.dataset.action,data:{order_id:d()("input[name=package_order_id]").val()}}).then((e=>{e&&(d()("#cdek-courier-result-block").hide(),d()("#cdek-order-courier").show())})).catch((e=>console.error(e))).finally((()=>d()("#cdek-loader").hide()))})),d()("#cdek-info-order").on("click","#cdek-order-status-btn",(function(e){let t=d()("#cdek-order-status-list"),r=d()("#cdek-btn-arrow-up"),a=d()("#cdek-btn-arrow-down");t.toggle(),r.toggle(!t.is(":visible")),a.toggle(t.is(":visible"))}))}))})();